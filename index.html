<!DOCTYPE html>


<html>
    <head>
        <title>Satisfactory factory Planner</title>
        <link rel="stylesheet" href="styles.css">






    <script>
        function loadState(){
            //loadFactory()
            BuildAllTables()
            BuildAddTable()
            PowerTable()
        }
        window.addEventListener('load', loadState);
    </script>
 <!--Item Basics  -->
<script>
        // Each Pair of tiers gets its own list-> mor emodular? Maybe?
        var FactoryItems = 
        [
            // 0
            [
                {id:"IronOre",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:1,Recepice:[
                    {Name: "Iron Ore Mk1", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Iron Ore Mk2", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Iron Ore Mk3", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"IronBar",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Iron Ingot", PerBuilding:30,Buildings:0,  Req:[{id:"IronOre",Nr:1}]},
                    {Name: "Pure Iron Ingot", PerBuilding:65,Buildings:0,  Req:[{id:"IronOre",Nr:7/13}, {id:"Water",Nr:4/13}]},
                    {Name: "Iron Alloy Ingot", PerBuilding:75,Buildings:0,  Req:[{id:"IronOre",Nr:8/15}, {id:"CopperOre",Nr:2/15}]},
                    {Name: "Basic Iron Ingot", PerBuilding:50,Buildings:0,  Req:[{id:"IronOre",Nr:0.5}, {id:"Limestone",Nr:0.8}]},
                    {Name: "Leeched Iron Ingot", PerBuilding:100,Buildings:0,  Req:[{id:"IronOre",Nr:0.5}, {id:"Sulfuric Acid",Nr:0.1}]},
                   ]},
                {id:"IronRod",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,
                    Recepice:[
                    {Name: "Iron Rod", PerBuilding:15,Buildings:0,  Req:[{id:"IronBar",Nr:1}]},
                    {Name: "Steel Rod", PerBuilding:48,Buildings:0,  Req:[{id:"Steel Bar",Nr:1/4}]},
                    {Name: "Aluminium Rod", PerBuilding:48,Buildings:0,  Req:[{id:"Aluminium Ingot",Nr:1/7}]},
                   ]},
                {id:"IronScrew",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Iron Screw", PerBuilding:40,Buildings:0,  Req:[{id:"IronRod",Nr:0.25}]},
                    {Name: "Cast Screw", PerBuilding:50,Buildings:0,  Req:[{id:"IronBar",Nr:0.25}]},
                    {Name: "Steel Screw", PerBuilding:260,Buildings:0,  Req:[{id:"Steel Bar",Nr:1/52}]},
                   ]},
                {id:"Iron Plate",Name:"Iron Plate",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Iron Plate", PerBuilding:20,Buildings:0,  Req:[{id:"IronBar",Nr:1.5}]},
                    {Name: "Coated Plate", PerBuilding:75,Buildings:0,  Req:[{id:"IronBar",Nr:0.5},{id:"Plastic",Nr:0.1}]},
                    {Name: "Steel Plate", PerBuilding:45,Buildings:0,  Req:[{id:"IronOre",Nr:1/3}, {id:"Steel Bar",Nr:1/3}]},
                   ]},
                {id:"Limestone",Name:"Limestone",Asked:0,Needed:0,NeededList:[], color:"bisque", RecipeNr:1, Recepice:[
                    {Name: "Limestone", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Limestone", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Limestone", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"Concrete",Name:"Concrete",Asked:0,Needed:0,NeededList:[], color:"bisque", RecipeNr:0,Recepice:[
                    {Name: "Concrete", PerBuilding:"15",Buildings:0,  Req:[{id:"Limestone",Nr:3}]},
                    {Name: "Wet Concrete", PerBuilding:"50",Buildings:0,  Req:[{id:"Limestone",Nr:1.5},{id:"Water",Nr:1.25}]},
                    {Name: "Rubber Concrete", PerBuilding:"90",Buildings:0,  Req:[{id:"Limestone",Nr:10/9},{id:"Rubber",Nr:2/9}]},
                    {Name: "Fine Concrete", PerBuilding:"50",Buildings:0,  Req:[{id:"Limestone",Nr:1.2},{id:"Silica",Nr:0.3}]},
                   ]},
                {id:"CopperOre",Name:"Copper Ore",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:1,Recepice:[
                    {Name: "Copper Ore", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Copper Ore", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Copper Ore", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"CopperBar",Name:"Copper Bar",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Copper Bar", PerBuilding:30,Buildings:0,  Req:[{id:"CopperOre",Nr:1}]},
                    {Name: "Pure Copper Bar", PerBuilding:35,Buildings:0,  Req:[{id:"CopperOre",Nr:0.6}, {id:"Water",Nr:4/15}]},
                    {Name: "Copper Alloy Bar", PerBuilding:100,Buildings:0,  Req:[{id:"IronOre",Nr:0.5}, {id:"CopperOre",Nr:0.5}]},
                    {Name: "Tempered Copper Bar", PerBuilding:60,Buildings:0,  Req:[{id:"CopperOre",Nr:5/12}, {id:"Petroleum Coke",Nr:2/3}]},
                    {Name: "Leeched Copper Bar", PerBuilding:110,Buildings:0,  Req:[{id:"CopperOre",Nr:9/22}, {id:"Sulfuric Acid",Nr:5/22}]},
                   ]},
                {id:"Copper Wire",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Copper Wire", PerBuilding:"30",Buildings:0,  Req:[{id:"CopperBar",Nr:0.5}]},
                    {Name: "Caterium Wire", PerBuilding:"120",Buildings:0,  Req:[{id:"Caterium Bar",Nr:0.125}]},
                    {Name: "Fused Wire", PerBuilding:"90",Buildings:0,  Req:[{id:"Caterium Bar",Nr:1/30},{id:"CopperBar",Nr:2/15}]},
                    {Name: "Iron Wire", PerBuilding:"22.5",Buildings:0,  Req:[{id:"IronBar",Nr:5/9}]},
                    ]},
                {id:"Cable",Name:"Cable",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Cable", PerBuilding:"30",Buildings:0,  Req:[{id:"Copper Wire",Nr:2}]},
                    {Name: "Coated Cable", PerBuilding:"67.5",Buildings:0,  Req:[{id:"Copper Wire",Nr:5/9},{id:"HeavyOilResidue",Nr:2/9}]},
                    {Name: "Insulated Cable", PerBuilding:"100",Buildings:0,  Req:[{id:"Copper Wire",Nr:0.45},{id:"Rubber",Nr:0.3}]},
                    {Name: "Quickwire Cable", PerBuilding:"27.5",Buildings:0,  Req:[{id:"Quickwire",Nr:3/11},{id:"Rubber",Nr:2/11}]},
                ]},
            ],
            // 1
            [
                {id:"Reinforced Plate",Name:"Reinforced Plate",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Reinfoced Plate", PerBuilding:"5",Buildings:0,  Req:[{id:"Iron Plate",Nr:3},{id:"IronScrew",Nr:12}]},
                    {Name: "Stiched Plate", PerBuilding:"5.625",Buildings:0,  Req:[{id:"Iron Plate",Nr:10/3},{id:"Copper Wire",Nr:20/3}]},
                    {Name: "Bolted Plate", PerBuilding:"15",Buildings:0,  Req:[{id:"Iron Plate",Nr:6},{id:"IronScrew",Nr:50/3}]},
                    {Name: "Adhered Iron Plate", PerBuilding:"3.75",Buildings:0,  Req:[{id:"Iron Plate",Nr:3},{id:"Rubber",Nr:1}]},
                ]},
                {id:"Modular Frame",Name:"Modular Frame",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Modular Frame", PerBuilding:"2",Buildings:0,  Req:[{id:"Reinforced Plate",Nr:1.5},{id:"IronRod",Nr:6}]},
                    {Name: "Placeholder", PerBuilding:"3",Buildings:0,  Req:[{id:"Reinforced Plate",Nr:2},{id:"Steel Tube",Nr:10/3}]},
                   ]},
                {id:"Rotor",Name:"Rotor",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Rotor", PerBuilding:"4",Buildings:0,  Req:[{id:"IronRod",Nr:5},{id:"IronScrew",Nr:25}]},
                    {Name: "Steel Rotor", PerBuilding:"5",Buildings:0,  Req:[{id:"Steel Tube",Nr:2},{id:"IronScrew",Nr:25}]},
                   ]},
                {id:"Smart Plating",Name:"Smart Plating",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Smart Plating", PerBuilding:"2",Buildings:0,  Req:[{id:"Reinforced Plate",Nr:1},{id:"Copper Wire",Nr:6}]}]}
            ],
            // 2
            [
                {id:"Caterium Ore",Name:"Caterium Ore",Asked:0,Needed:0,NeededList:[], color:"gold", RecipeNr:1,Recepice:[
                    {Name: "Caterium Ore Mk1", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Caterium Ore Mk2", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Caterium Ore Mk3", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"Caterium Bar",Asked:0,Needed:0,NeededList:[], color:"gold", RecipeNr:0,Recepice:[
                    {Name: "Caterium Bar", PerBuilding:15,Buildings:0,Req:[{id:"Caterium Ore",Nr:3}]},
                    {Name: "Pure Caterium Bar", PerBuilding:65,Buildings:0,  Req:[{id:"Caterium Ore",Nr:2}, {id:"Water",Nr:2}]},
                   ]},
                {id:"Quickwire",Asked:0,Needed:0,NeededList:[], color:"gold", RecipeNr:0,Recepice:[
                    {Name: "Quickwire", PerBuilding:"60",Buildings:0,Req:[{id:"Caterium Bar",Nr:0.2}]}
                   ]},
                {id:"AI Limiter",Asked:0,Needed:0,NeededList:[], color:"gold", RecipeNr:0,Recepice:[
                    {Name: "AI Limiter", PerBuilding:"5",Buildings:0,Req:[{id:"Copper Sheet",Nr:5},{id:"Quickwire",Nr:20}]}
                   ]},
                {id:"High-Speed Connector",Asked:0,Needed:0,NeededList:[], color:"gold", RecipeNr:0,Recepice:[
                    {Name: "High-Speed Connector", PerBuilding:"3.75",Buildings:0,Req:[{id:"Quickwire",Nr:56},{id:"Cable",Nr:10},{id:"Circuit Board",Nr:1}]}
                   ]},
                {id:"Quartz",Asked:0,Needed:0,NeededList:[], color:"fuchsia", RecipeNr:1,Recepice:[
                    {Name: "Quartz", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Quartz", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Quartz", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"Quartz Crystal",Asked:0,Needed:0,NeededList:[], color:"fuchsia", RecipeNr:0,Recepice:[
                    {Name: "Quartz Crystal", PerBuilding:"22.5",Buildings:0,Req:[{id:"Quartz",Nr:5/6}]}
                   ]},
                {id:"Crystal Oscillator",Asked:0,Needed:0,NeededList:[], color:"fuchsia", RecipeNr:0,Recepice:[
                    {Name: "Crystal Oscillator", PerBuilding:"1",Buildings:0,Req:[{id:"Quartz Crystal",Nr:18},{id:"Cable",Nr:14},{id:"Reinforced Plate",Nr:2.5}]}
                   ]},
                {id:"Silica",Name:"Silica",Asked:0,Needed:0,NeededList:[], color:"fuchsia", RecipeNr:0,Recepice:[
                    {Name: "Silica", PerBuilding:"37.5",Buildings:0,Req:[{id:"Quartz",Nr:0.6}]}
                   ]},
                {id:"Sulfur",Name:"Sulfur",Asked:0,Needed:0,NeededList:[], color:"yellow", RecipeNr:0,Recepice:[
                    {Name: "Sulfur", PerBuilding:"120",Buildings:0,Req:[]}]}
            ],
            // 3
            [
                {id:"Water",Name: "Water", Asked:0, Needed:0, NeededList:[], color:"blue", RecipeNr:0, Recepice:[
                    {Name: "Water", PerBuilding:120,Buildings:0, Req:[]}
                   ]},
                {id:"Copper Sheet",Name:"Copper Sheet", Asked:0, Needed:0, NeededList:[], color:"orange", RecipeNr:0, Recepice:[
                    {Name: "Copper Sheet", PerBuilding:10, Buildings:0,  Req:[{id:"CopperBar", Nr:2}]}
                   ]},
                {id:"Coal",Name:"Coal",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:1,Recepice:[
                    {Name: "Coal", PerBuilding:60,Buildings:0, Req:[]},
                    {Name: "Coal", PerBuilding:120,Buildings:0, Req:[]},
                    {Name: "Coal", PerBuilding:240,Buildings:0, Req:[]}
                   ]},
                {id:"Steel Bar",Name:"Steel Bar",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Steel Bar", PerBuilding:"45",Buildings:0,  Req:[{id:"Coal",Nr:1},{id:"IronOre",Nr:1}]},
                    {Name: "Steel Bar", PerBuilding:"60",Buildings:0,  Req:[{id:"Coal",Nr:2/3},{id:"IronBar",Nr:2/3}]},
                ]},
                {id:"Steel Beam",Name:"Steel Beam",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Steel Beam", PerBuilding:"15",Buildings:0,  Req:[{id:"Steel Bar",Nr:4}]},
                   ]},
                {id:"Steel Tube",Name:"Steel Tube",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Steel Pipe", PerBuilding:"20",Buildings:0,  Req:[{id:"Steel Bar",Nr:1.5}]},
                    {Name: "Iron Pipe", PerBuilding:"25",Buildings:0,  Req:[{id:"IronBar",Nr:4}]},
                   ]},
                {id:"Versatile Framework",Name:"Versatile Framework",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Versatile Framework", PerBuilding:"5",Buildings:0,  Req:[{id:"Modular Frame",Nr:0.5},{id:"Steel Beam",Nr:6}]}
                   ]},
                {id:"Encased Industrial Beam",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0, Recepice:[
                    {Name: "Encased Industrial Beam", PerBuilding:"6",Buildings:0,  Req:[{id:"Steel Beam",Nr:4},{id:"Concrete",Nr:5}]},
                    {Name: "Placeholder", PerBuilding:"4",Buildings:0,  Req:[{id:"Steel Tube",Nr:7},{id:"Concrete",Nr:5}]}
                   ]},
                {id:"Stator",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Stator", PerBuilding:"5",Buildings:0,  Req:[{id:"Copper Wire",Nr:8},{id:"Steel Tube",Nr:3}]}
                   ]},
                {id:"Motor",Name:"Motor",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Motor", PerBuilding:"5",Buildings:0,  Req:[{id:"Rotor",Nr:2},{id:"Stator",Nr:2}]},
                    {Name: "Motor", PerBuilding:"7.5",Buildings:0, Req:[{id:"Rotor",Nr:2},{id:"Elektromagnetic Control Rod",Nr:1}]},
                   ]},
                {id:"Automated Wiring",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name:"Automated Wireng", PerBuilding:"2.5",Buildings:0,  Req:[{id:"Cable",Nr:20},{id:"Stator",Nr:1}]}]}
            ],
            // 4
            [
                {id:"Oil",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Oil Extractor", PerBuilding:120,Buildings:0,Req:[]}
                   ]},
                {id:"Plastic",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Plastic", PerBuilding:"20",Buildings:0,Req:[{id:"Oil",Nr:1.5},{id:"HeavyOilResidue",Nr:-0.5}]},
                    {Name: "Residual Plastic", PerBuilding:"20",Buildings:0,Req:[{id:"Water",Nr:1},{id:"Polymer Resin",Nr:3}]},
                    {Name: "Reclaimed Plastic", PerBuilding:"60",Buildings:0,Req:[{id:"Fuel",Nr:0.5},{id:"Rubber",Nr:0.5}]},
                    {Name: "Plastic with Oil Trippler", PerBuilding:"86.666",Buildings:0,Req:[{id:"Oil",Nr:1/3},{id:"Water",Nr:0.8666}]},
                   ]},
                {id:"Rubber",Name:"Rubber",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Rubber", PerBuilding:"20",Buildings:0,Req:[{id:"Oil",Nr:1.5},{id:"HeavyOilResidue",Nr:-1}]},
                    {Name: "Residual Rubber", PerBuilding:"20",Buildings:0,Req:[{id:"Water",Nr:2},{id:"Polymer Resin",Nr:2}]},
                    {Name: "Reclaimed Rubber", PerBuilding:"60",Buildings:0,Req:[{id:"Fuel",Nr:0.5},{id:"Plastic",Nr:0.5}]},
                   ]},
                {id:"HeavyOilResidue",Name:"Heavy Oil-Residue",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Heavy Oil Residue Byproduct", PerBuilding:"0",Buildings:null,Req:[]},
                    {Name: "Heavy Oil Residue", PerBuilding:"40",Buildings:0,Req:[{id:"Oil",Nr:0.75},{id:"Polymer Resin",Nr:-0.5}]}
                   ]},
                {id:"Polymer Resin",Name:"Polymer Resin",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Polymer Resin Byprodct", PerBuilding:"0",Buildings:null,Req:[]},
                    {Name: "Polymer Resin", PerBuilding:"130",Buildings:0,Req:[{id:"Oil",Nr:6/13},{id:"HeavyOilResidue",Nr:-2/13}]},
                    {Name: "Polymer Resin to plastic", PerBuilding:-120,Buildings:0,Req:[{id:"Water",Nr:1/3},{id:"Plastic",Nr:-1/3}]},
                    {Name: "Polymer Resin to Rubber", PerBuilding:-120,Buildings:0,Req:[{id:"Water",Nr:1/3},{id:"Rubber",Nr:-1/3}]},
                   ]},
                {id:"Petroleum Coke",Name:"Petroleum Coke",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Petroleum Coke", PerBuilding:"120",Buildings:0,Req:[{id:"HeavyOilResidue",Nr:1/3}]}
                   ]},
                {id:"Fuel",Name:"Fuel",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Fuel", PerBuilding:"40",Buildings:0,Req:[{id:"Oil",Nr:1.5},{id:"Polymer Resin",Nr:-0.75}]},
                    {Name: "Residual Fuel", PerBuilding:"40",Buildings:0,Req:[{id:"HeavyOilResidue",Nr:1.5}]},
                    {Name: "Diluted Fuel", PerBuilding:"60",Buildings:0,Req:[{id:"HeavyOilResidue",Nr:0.5},{id:"Water",Nr:1}]},
                   ]},
                {id:"Canister",Name:"Canister",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Canister", PerBuilding:"60",Buildings:0,Req:[{id:"Plastic",Nr:0.5}]}
                   ]},
                {id:"Packeged Fuel",Name:"Packeged Fuel",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Packeged Fuel", PerBuilding:"40",Buildings:0,Req:[{id:"Canister",Nr:1},{id:"Fuel",Nr:1}]}
                   ]},
            ],
            // 5
            [
                {id:"Circuit Board",Asked:0,Needed:0,NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Circuit Board", PerBuilding:"7.5",Buildings:0,Req:[{id:"Copper Sheet",Nr:2},{id:"Plastic",Nr:4}]},
                    {Name: "Caterium Circuit Board", PerBuilding:"8.75",Buildings:0,Req:[{id:"Quickwire",Nr:2},{id:"Plastic",Nr:4}]},
                    {Name: "Placeholder", PerBuilding:"5",Buildings:0,Req:[{id:"Rubber",Nr:4},{id:"Petroleum Coke",Nr:8}]},
                   ]},
                {id:"Computer",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Computer", PerBuilding:"2.5",Buildings:0,Req:[{id:"Circuit Board",Nr:10},{id:"Cable",Nr:8},{id:"Plastic",Nr:16}]},
                    {Name: "Caterium Computer", PerBuilding:10/3,Buildings:0,Req:[{id:"Circuit Board",Nr:1.5},{id:"Crystal Oscillator",Nr:0.5}]},

                   ]},
                {id:"Heavy Modular Frame",Name:"Heavy Modular Frame",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Heavy Modular Frame", PerBuilding:"2",Buildings:0,Req:[{id:"Modular Frame",Nr:5},{id:"Steel Tube",Nr:15},{id:"Encased Industrial Beam",Nr:5},{id:"IronScrew",Nr:100}]},
                    {Name: "Encased Heavy Modular Frame", PerBuilding: 45/16,Buildings:0,Req:[{id:"Modular Frame",Nr:8/3},{id:"Steel Tube",Nr:12},{id:"Encased Industrial Beam",Nr:10/3},{id:"Concrete",Nr:22/3}]},
                    {Name: "Placeholder", PerBuilding:"3.75",Buildings:0,Req:[{id:"Modular Frame",Nr:5},{id:"Rubber",Nr:20},{id:"Encased Industrial Beam",Nr:3},{id:"IronScrew",Nr:104}]},
                   ]},
                {id:"Modular Engine",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name: "Modular Engine", PerBuilding:"1",Buildings:0,Req:[{id:"Motor",Nr:2},{id:"Rubber",Nr:15},{id:"Smart Plating",Nr:2}]}
                   ]},
                {id:"Adaptive Control Unit",Name:"",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Adaptive Control Unit", PerBuilding:"1",Buildings:0,Req:[{id:"Automated Wiring",Nr:15},{id:"Circuit Board",Nr:10},{id:"Heavy Modular Frame",Nr:2},{id:"Computer",Nr:2}]}]}
            ],
            // 6
            [
                {id:"Bauxit",Name:"Bauxit",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:1,Recepice:[
                    {Name: "Bauxit", PerBuilding:60,Buildings:0,Req:[]},
                    {Name: "Bauxit", PerBuilding:120,Buildings:0,Req:[]},
                    {Name: "Bauxit", PerBuilding:240,Buildings:0,Req:[]}
                   ]},
                {id:"Alumina Solution",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:0,Recepice:[
                    {Name: "Alumina Solution", PerBuilding:"120",Buildings:0,Req:[{id:"Silica",Nr:-5/12},{id:"Water",Nr:1.5},{id:"Bauxit",Nr:1}]}
                   ]},
                {id:"Aluminum Scrap",Name:"Aluminum Scrap",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:0,Recepice:[
                    {Name: "Aluminum Scrap", PerBuilding:"360",Buildings:0,Req:[{id:"Alumina Solution",Nr:2/3},{id:"Coal",Nr:1/3},{id:"Water",Nr:-1/3}]},
                    {Name: "Placeholder", PerBuilding:"300",Buildings:0,Req:[{id:"Alumina Solution",Nr:0.6},{id:"Petroleum Coke",Nr:0.2},{id:"Water",Nr:-7/20}]}
                ]},
                {id:"Aluminium Ingot",Name:"Aluminium Ingot",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:0,Recepice:[
                    {Name: "Aluminium Ingot", PerBuilding:"60",Buildings:0,Req:[{id:"Silica",Nr:1.25},{id:"Aluminum Scrap",Nr:1.5}]}
                   ]},
                {id:"Aluminum Casing",Name:"Aluminum Casing",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:0,Recepice:[
                    {Name: "Aluminum Casing", PerBuilding:"60",Buildings:0,Req:[{id:"Aluminium Ingot",Nr:1.5}]},
                    {Name: "Alclad Casing", PerBuilding:"112.5",Buildings:0,Req:[{id:"Aluminium Ingot",Nr:4/3},{id:"CopperBar",Nr:2/3}]}
                   ]},
                {id:"Alclad Aluminum Sheet",Name:"Alclad Aluminum Sheet",Asked:0,Needed:0,NeededList:[], color:"peru", RecipeNr:0,Recepice:[
                    {Name: "Alclad Aluminum Sheet", PerBuilding:"30",Buildings:0,Req:[{id:"Aluminium Ingot",Nr:1},{id:"CopperBar",Nr:1/3}]}
                   ]},
            ],
            // 7
            [
                {id:"Radio Control Unit",Name:"Radio Control Unit",Asked:0,Needed:0,NeededList:[], color:"fuchsia", RecipeNr:0,Recepice:[
                    {Name: "Radio Control Unit", PerBuilding:"2.5",Buildings:0,Req:[{id:"Aluminum Casing",Nr:16},{id:"Crystal Oscillator",Nr:0.5},{id:"Computer",Nr:0.5}]}
                   ]},
                {id:"Supercomputer",Name:"Supercomputer",Asked:0,Needed:0,NeededList:[], color:"orange", RecipeNr:0,Recepice:[
                    {Name: "Supercomputer", PerBuilding:"1.875",Buildings:0,Req:[{id:"Computer",Nr:2},{id:"AI Limiter",Nr:2},{id:"High-Speed Connector",Nr:3},{id:"Plastic",Nr:28}]},
                    {Name: "OC Supercomputer", PerBuilding:"3",Buildings:0,Req:[{id:"Radio Control Unit",Nr:2},{id:"Cooling System",Nr:2}]}
                   ]},
                {id:"Sulfuric Acid",Name:"Sulfuric Acid",Asked:0,Needed:0,NeededList:[], color:"yellow", RecipeNr:0,Recepice:[
                    {Name: "Sulfuric Acid", PerBuilding:"50",Buildings:0,Req:[{id:"Water",Nr:1},{id:"Sulfur",Nr:1}]}
                   ]},
                {id:"Battery",Name:"Battery",Asked:0,Needed:0,NeededList:[], color:"yellow", RecipeNr:0,Recepice:[
                    {Name: "Battery", PerBuilding:"20",Buildings:0,Req:[{id:"Sulfuric Acid",Nr:2.5},{id:"Alumina Solution",Nr:2},{id:"Aluminum Casing",Nr:1},{id:"Water",Nr:-1.5}]}
                   ]},
            ],
            // 8
            [
                {id:"Nitrogen Gas",Name:"Nitrogen Gas",Asked:0,Needed:0,NeededList:[{id:"Nitric Acid",Nr:0}],color:"black",RecipeNr:0,Recepice:[
                    {Name: "Nitrogen Gas", PerBuilding:"120",Buildings:0,Req:[]}
                    ]},
                {id:"Fused Modular Frame",Name:"Fused Modular Frame",Asked:0,Needed:0,NeededList:[],color:"black",RecipeNr:0,Recepice:[
                    {Name: "Fused Modular Frame", PerBuilding:"1.5",Buildings:0,Req:[{id:"Heavy Modular Frame",Nr:1},{id:"Aluminum Casing",Nr:50},{id:"Nitrogen Gas",Nr:25}]},
                    {Name: "Placeholder", PerBuilding:"3",Buildings:0,Req:[{id:"Heavy Modular Frame",Nr:1},{id:"Aluminum Ingot",Nr:50},{id:"Nitric Acid",Nr:8}, {if:"Fuel", Nr:10}]},
                    ]},
                {id:"Heat Sink",Name:"Heat Sink",Asked:0,Needed:0,NeededList:[{id:"Plutonium Fuel Rod",Nr:0}],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Heat Sink", PerBuilding:"7.5",Buildings:0,Req:[{id:"Alclad Aluminum Sheet",Nr:5},{id:"Copper Sheet",Nr:3}]},
                    {Name: "Placeholder", PerBuilding:"10",Buildings:0,Req:[{id:"Aluminum Casing",Nr:3},{id:"Rubber",Nr:3}]}
                    ]},
                {id:"Cooling System",Name:"Cooling System",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Cooling System", PerBuilding:"6",Buildings:0,Req:[{id:"Heat Sink",Nr:2},{id:"Rubber",Nr:2},{id:"Water",Nr:5},{id:"Nitrogen Gas",Nr:25}]},
                    {Name: "Placeholder", PerBuilding:"5",Buildings:0,Req:[{id:"Heat Sink",Nr:2},{id:"motor",Nr:0.5},{id:"Nitrogen Gas",Nr:12}]},
                    ]},
                {id:"Turbo Motor",Name:"Turbo Motor",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Turbo Motor", PerBuilding:"1.875",Buildings:0,Req:[{id:"Cooling System",Nr:4},{id:"Radio Control Unit",Nr:2},{id:"Motor",Nr:4},{id:"Rubber",Nr:24}]},
                    {Name: "Placeholder", PerBuilding:"2.813",Buildings:0,Req:[{id:"Radio Control Unit",Nr:3},{id:"Elektromagnetic Control Rod",Nr:5/3},{id:"Motor",Nr:7/3},{id:"Rotor",Nr:7/3}]},
                    {Name: "Placeholder", PerBuilding:"1.875",Buildings:0,Req:[{id:"Nitrogen Gas",Nr:24},{id:"Pressure Conversion Cube",Nr:2},{id:"Motor",Nr:2},{id:"Stator",Nr:4}]},
                    ]},
                {id:"Nitric Acid",Name:"Nitric Acid",Asked:0,Needed:0,NeededList:[{id:"Non-fissile Uranium",Nr:0}],color:"black",RecipeNr:0,Recepice:[
                    {Name: "Nitric Acid", PerBuilding:"30",Buildings:0,Req:[{id:"Nitrogen Gas",Nr:4},{id:"Water",Nr:1},{id:"Iron Plate",Nr:0.3333333333333333}]},
                    ]},
                {id:"Assembly Director System",Name:"Assembly Director System",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Assembly Director System", PerBuilding:0.75,Buildings:0,Req:[{id:"Adaptive Control Unit",Nr:2},{id:"Supercomputer",Nr:1}]},
                    ]},
                {id:"Magnetic Field Generator",Name:"Magnetic Field Generator",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Magnetic Field Generator", PerBuilding:1,Buildings:0,Req:[{id:"Versatile Framework",Nr:2.5},{id:"Elektromagnetic Control Rod",Nr:1}]},
                    ]},
                {id:"Thermal Propulsion Rocket",Name:"Thermal Propulsion Rocket",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Thermal Propulsion Rocket", PerBuilding:1,Buildings:0,Req:[{id:"Modular Engine",Nr:2.5},{id:"Turbo Motor",Nr:1},{id:"Cooling System",Nr:3},{id:"Fused Modular Frame",Nr:1}]},
                    ]},
                {id:"Nuclear Pasta",Name:"Nuclear Pasta",Asked:0,Needed:0,NeededList:[],color:"peru",RecipeNr:0,Recepice:[
                    {Name: "Nuclear Pasta", PerBuilding:1,Buildings:0,Req:[{id:"Pressure Conversion Cube",Nr:1},{id:"Copper Powder",Nr:200}]},
                    ]},
                {id:"Copper Powder",Name:"Copper Powder",Asked:0,Needed:0,NeededList:[],color:"orange",RecipeNr:0,Recepice:[
                    {Name: "Copper Powder", PerBuilding:"50",Buildings:0,Req:[{id:"CopperBar",Nr:6}]},
                    ]},
                {id:"Pressure Conversion Cube",Name:"Pressure Conversion Cube",Asked:0,Needed:0,NeededList:[],RecipeNr:0,Recepice:[
                    {Name: "Pressure Conversion Cube", PerBuilding:"1",Buildings:0,Req:[{id:"Fused Modular Frame",Nr:1},{id:"Radio Control Unit",Nr:2}]}]}
            ],
            // 9
            [
                {id:"UraniumOre",Name:"Uranium Ore",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:2,Recepice:[
                    {Name: "Uranium Ore", PerBuilding:60,Buildings:2,Req:[]},
                    {Name: "Uranium Ore", PerBuilding:120,Buildings:2,Req:[]},
                    {Name: "Uranium Ore Mk 3", PerBuilding:240,Buildings:0,Req:[]},
                    ]},
                {id:"Encased Uranium Cell",Name:"Encased Uranium Cell",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Encased Uranium Cell", PerBuilding:"25",Buildings:0,Req:[{id:"UraniumOre",Nr:2},{id:"Concrete",Nr:0.6},{id:"Sulfuric Acid",Nr:1.6},{id:"Encased Uranium Cell Return",Nr:-0.4}]},
                    {Name: "Placeholder", PerBuilding:"20",Buildings:0,Req:[{id:"UraniumOre",Nr:1.25},{id:"Silica",Nr:0.75},{id:"Sulfur",Nr:1.25},{id:"Quickwire",Nr:3.75}]},
                    ]},
                {id:"Elektromagnetic Control Rod",Asked:0,Needed:0,NeededList:[], color:"red", RecipeNr:0,Recepice:[
                    {Name:"Elektromagnetic Control Rod", PerBuilding:"4",Buildings:0,Req:[{id:"AI Limiter",Nr:1},{id:"Stator",Nr:1.5}]},
                    ]},
                {id:"Uranium Fuel Rod",Name:"Uranium Fuel Rod",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Uranium Fuel Rod", PerBuilding:"0.4",Buildings:0,Req:[{id:"Encased Uranium Cell",Nr:50},{id:"Encased Industrial Beam",Nr:3},{id:"Elektromagnetic Control Rod",Nr:5}]}
                ]},
                {id:"Uranium Waste",Name:"Uranium Waste",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Uranium Waste", PerBuilding:"0",Buildings:null,Req:[]},
                    ]},
                {id:"Non-fissile Uranium",Name:"Non-fissile Uranium",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Non-fissile Uranium", PerBuilding:"50", Buildings:0,Req:[{id:"Uranium Waste",Nr:0.75},{id:"Silica",Nr:0.5},{id:"Nitric Acid",Nr:0.3},{id:"Sulfuric Acid",Nr:0.3},{id:"Water",Nr:-0.3}]},
                    {Name: "fertile Uranium", PerBuilding:"100",Buildings:0,Req:[{id:"Uranium Waste",Nr:0.25},{id:"Uranium",Nr:0.25},{id:"Nitric Acid",Nr:0.15},{id:"Sulfuric Acid",Nr:0.25},{id:"Water",Nr:-0.4}]},
                ]},
                {id:"Plutonium Pellet",Name:"Plutonium Pellet",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Plutonium Pellet", PerBuilding:"30",Buildings:0,Req:[{id:"Non-fissile Uranium",Nr:10/3},{id:"Uranium Waste",Nr:5/6},{id:"Power by Hand",Nr:500}]},
                    ]},
                {id:"Encased Plutonium Cell",Name:"Encased Plutonium Cell",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Encased Plutonium Cell", PerBuilding:"5",Buildings:0,Req:[{id:"Plutonium Pellet",Nr:2},{id:"Concrete",Nr:4}]},
                    ]},
                {id:"Plutonium Fuel Rod",Name:"Plutonium Fuel Rod",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Plutonium Fuel Rod", PerBuilding:"0.25",Buildings:0,Req:[{id:"Encased Plutonium Cell",Nr:30},{id:"Steel Beam",Nr:18},{id:"Elektromagnetic Control Rod",Nr:6},{id:"Heat Sink",Nr:10}]},
                    {Name: "Plutonium Fuel Unit", PerBuilding:"0.5",Buildings:0,Req:[{id:"Encased Plutonium Cell",Nr:20},{id:"Pressure Conversion Cube",Nr:1}]}
                    ]},
                {id:"Plutonium Waste",Name:"Plutonium Waste",Asked:0,Needed:0,NeededList:[], color:"lime", RecipeNr:0,Recepice:[
                    {Name: "Plutonium Waste", PerBuilding:"0",Buildings:null,Req:[]},
                    ]},
                {id:"Ficsonium",Name: "Ficsonium",Asked: 0,Needed: 0,NeededList: [], color:"lime",RecipeNr: 0,Recepice: [
                    {Name: "Ficsonium", PerBuilding: "10",Buildings: 0,Req: [ { id: "Plutonium Waste",Nr: 1},{ id: "Singularity Cell",Nr: 1},{ id: "Dark Matter Resdiue",Nr: 20}]}
                ]},
                {id:"Ficsonium Fuel Rod",Name: "Ficsonium Fuel Rod",Asked: 0,Needed: 0,NeededList: [], color:"lime",RecipeNr: 0,Recepice: [ 
                    {Name: "Ficsonium Fuel Rod", PerBuilding:"2.5",Buildings: 0,Req: [{ id: "Ficsonium",Nr:2},{ id: "Elektromagnetic Control Rod",Nr: 2},{ id: "FICSIT Trigon",Nr: 40},{ id: "Excited Photonic Matter",Nr: 20},{ id: "Dark Matter Resdiue",Nr: -20}]}  
                ]}
            ],
            // 10
            [
            {id:"SAM",Name:"SAM",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:1,Recepice:[
                {Name: "SAM", PerBuilding:60,Buildings:0,Req:[]},
                {Name: "SAM", PerBuilding:120,Buildings:0,Req:[]},
                {Name: "SAM", PerBuilding:240,Buildings:0,Req:[]},
                    ]},
            {id:"Reanimated SAM",Name:"Reanimated SAM",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Reanimated SAM", PerBuilding:30,Buildings:0,Req:[{id:"SAM",Nr:4}]}
                ]},
            {id:"SAM Fluctuator",Name:"SAM  Fluctuator",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "AM Fluctuator", PerBuilding:10,Buildings:0,Req:[{id:"Reanimated SAM",Nr:6},{id:"Copper Wire",Nr:5},{id:"Steel Tube",Nr:3}]},
                    ]},
            {id:"FICSIT Ingot",Name:"FICSIT Ingot",Asked:0,Needed:0,NeededList:[],RecipeNr:0,Recepice:[
                {Name: "FICSIT Ingot (Iron)", PerBuilding:"10",Buildings:0,Req:[{id:"Reanimated SAM",Nr:4},{id:"IronBar",Nr:24}]},
                {Name: "FICSIT Ingot (Caterium)", PerBuilding:15,Buildings:0,Req:[{id:"Reanimated SAM",Nr:3},{id:"Caterium Bar",Nr:4}]},
                {Name: "FICSIT Ingot (Aluminium)", PerBuilding:40,Buildings:0,Req:[{id:"Reanimated SAM",Nr:2},{id:"Aluminium Ingot",Nr:4}]},
                    ]},
            {id:"FICSIT Trigon",Name:"FICSIT Trigon",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "FICSIT Trigon", PerBuilding:30,Buildings:0,Req:[{id:"FICSIT Ingot",Nr:1/3}]},
                    ]},
            {id:"Diamond",Name:"Diamond",Asked:"0",Needed:60,NeededList:[{id:"out",Nr:60}],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "DIamond", PerBuilding:30,Buildings:2,Req:[{id:"Coal",Nr:20},{id:"Power by Hand",Nr:50/3}]},
                    ]},
            {id:"Time Crystal",Name:"Time Crystal",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Time Crystal", PerBuilding:6,Buildings:0,Req:[{id:"Diamond",Nr:2}]},
                    ]},
            {id:"Excited Photonic Matter",Name:"Excited Photonic Matter",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Excited Photonic Matter", PerBuilding:"200",Buildings:0,Req:[]},
                    ]},
            {id:"Dark Matter Resdiue",Name:"Dark Matter Resdiue",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Dark Matter Resdiue", PerBuilding:100,Buildings:0,Req:[{id:"Reanimated SAM",Nr:0.5}]},
                    ]},
            {id:"Dark Matter Crystal",Name:"Dark Matter Crystal",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Dark Matter Crystal", PerBuilding:30,Buildings:0,Req:[{id:"Diamond",Nr:1},{id:"Dark Matter Resdiue",Nr:5}]},
                {Name: "Dark Matter condensation", PerBuilding:20,Buildings:0,Req:[{id:"Dark Matter Resdiue",Nr:10}]},
                {Name: "Dark Matter Trap", PerBuilding:60,Buildings:0,Req:[{id:"Time Crystal",Nr:0.5},{id:"Dark Matter Resdiue",Nr:2.5}]},
                    ]},
            {id:"Superposition OSilator",Name:"Superposition OSilator",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Superposition Osilator", PerBuilding:5,Buildings:0,Req:[{id:"Dark Matter Crystal",Nr:6},{id:"Crystal Oscillator",Nr:1},{id:"Alclad Aluminum Sheet",Nr:9},{id:"Excited Photonic Matter",Nr:25},{id:"Dark Matter Resdiue",Nr:-25}]},
                    ]},
            ],
            // 11
            [
            {id:"Biochemic Sculptor",Name:"Biochemic Sculptor",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Biochemic Sculptor", PerBuilding:2,Buildings:0,Req:[{id:"Assembly Director System",Nr:0.25},{id:"FICSIT Trigon",Nr:20},{id:"Water",Nr:5}]},
                    ]},
            {id:"Neural Quantum Prozessor",Name:"Neural Quantum Prozessor",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Neural Quantum Prozessor", PerBuilding:3,Buildings:0,Req:[{id:"Time Crystal",Nr:5},{id:"Supercomputer",Nr:1},{id:"FICSIT Trigon",Nr:15},{id:"Excited Photonic Matter",Nr:25},{id:"Dark Matter Resdiue",Nr:-25}]},
                    ]},
            {id:"AI Expansion Server",Name:"AI Expansion Server",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "AI Expansion Server", PerBuilding:4,Buildings:0,Req:[{id:"Magnetic Field Generator",Nr:1},{id:"Neural Quantum Prozessor",Nr:1},{id:"Singularity Cell",Nr:1},{id:"Excited Photonic Matter",Nr:25},{id:"Dark Matter Resdiue",Nr:25}]},
                    ]},
            {id:"Singularity Cell",Name:"Singularity Cell",Asked:"0",Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Singularity Cell", PerBuilding:10,Buildings:0,Req:[{id:"Nuclear Pasta",Nr:0.1},{id:"Dark Matter Crystal",Nr:2},{id:"Iron Plate",Nr:10},{id:"Concrete",Nr:20}]},
                    ]},
            {id:"Balistic Warp Drive",Name:"Balistic Warp Drive",Asked:0,Needed:0,NeededList:[],color:"darkviolet",RecipeNr:0,Recepice:[
                {Name: "Balistic Warp Drive", PerBuilding:1,Buildings:0,Req:[{id:"Thermal Propulsion Rocket",Nr:1},{id:"Singularity Cell",Nr:5},{id:"Superposition OSilator",Nr:2},{id:"Dark Matter Crystal",Nr:40}]}]}
            ],
            // 12 This is no seen by the user and just for internal tracking.
            [
                {id:"Power by Hand",Name: "Power by Hand", Asked:0, Needed: 0, NeededList:[], color:"black", RecipeNr:0,Recepice:[
                    {Name: "Power", PerBuilding:"1",Buildings:0,Req:[]},
                ]},
                {id:"Encased Uranium Cell Return",Asked:0,Needed:0,NeededList:[], color:"yellow", RecipeNr:0,Recepice:[
                    {Name: "Sulfuric Acid Return", PerBuilding:"1",Buildings:0,Req:[{id:"Sulfuric Acid",Nr:1}]},
                ]},
            ],
        ]

        function AddToFactory(NewItem, TierIndex){
            // Check if the item with the same Id already exists
            console.log(TierIndex)
            var existingItem = FactoryItems[TierIndex].find(item => item.id === NewItem.id);
            if (existingItem) {
                console.log('Item '+NewItem.id +' already exists in Tier', TierIndex);
                return; // Exit the function to avoid adding the item again
            }

            FactoryItems[TierIndex].push(NewItem);
            console.log('Item '+NewItem.id+' added to Tier', TierIndex);
        };

        function getIndex(ID){
            var lengTiers =FactoryItems.length  
            for (var j = 0; j < lengTiers; j++) {
                var foundIndex = FactoryItems[j].findIndex(item => item.id === ID);

                if(foundIndex != -1){
                    return [j, foundIndex]
                }
            }
            console.log('Cant find', ID)
            return -1
        }

</script>

<!-- Calulation of Items-->
<script>

        function AddNeeded(ID, DepItem){
            var indexFactor = getIndex(ID)
            var TierIndex = indexFactor[0]
            var ItemIndex = indexFactor[1]

            var item = FactoryItems[TierIndex][ItemIndex];

            var NeededListIndex = item.NeededList.findIndex(item => item.id === DepItem.id);
            if(NeededListIndex === -1)
            {
                item.NeededList.push(DepItem)
                item.Needed = Number(DepItem.Nr)+Number(item.Needed);
            }
            else
            {
                // console.log("ALready have ", DepItem.id )
                // console.log(item.NeededList[NeededListIndex])
                // console.log(DepItem)
                
                //catch loops?
                console.log(Math.abs(item.NeededList[NeededListIndex].Nr - DepItem.Nr))
                if(Math.abs(item.NeededList[NeededListIndex].Nr - DepItem.Nr) < 0.001)
                {
                    return
                }

                var previousNeed = item.NeededList[NeededListIndex].Nr
                item.NeededList[NeededListIndex].Nr = Number(DepItem.Nr)
                item.Needed = Number(DepItem.Nr)+Number(item.Needed) - previousNeed;
                // console.log(item.NeededList[NeededListIndex])
            }
            FactoryItems[TierIndex][ItemIndex] = item; 
            CalcOneBuilding(TierIndex, ItemIndex)
            return
        }

        // This always uses the first /standard recipe! 
        // TODO: Set standard by resorting 
        function CalcOneBuilding(j,l){
            var item =  FactoryItems[j][l]
            // Loop over items in recipe
            var length = item.Recepice[item.RecipeNr].Req.length
            for (var l = 0; l < length; l++) {
                AddNeeded(item.Recepice[item.RecipeNr].Req[l].id, {id: item.id, Nr: item.Recepice[item.RecipeNr].Req[l].Nr*item.Needed})
            }
            
        }

        function AddPowers(){
            PowerSources.forEach(Source => {
                Source.Req.forEach(ReqItem => {
                    AddNeeded(ReqItem.id, {id: Source.id, Nr: Source.Buildings*ReqItem.Nr})
                })
            })
        }


        function CalcAllBuildings(){
            var lengTiers =FactoryItems.length  
            console.log("Tiers: ", lengTiers)
            for (var j = 0; j < lengTiers; j++) {
                var leng =FactoryItems[j].length  
                console.log("Items at tiers ", j, ": ", leng)
                for (var l = 0; l < leng; l++) {
                    FactoryItems[j][l].Needed=0;
                    FactoryItems[j][l].NeededList=[];
                }
            }
            for (var j = 0; j < lengTiers; j++) {
                var leng = FactoryItems[j].length  
                for (var l = 0; l < leng; l++) {
                    if(FactoryItems[j][l].Asked != 0)
                    {
                        FactoryItems[j][l].Needed = Number(FactoryItems[j][l].Asked)+Number(FactoryItems[j][l].Needed);
                        FactoryItems[j][l].NeededList.push({id: "out", Nr: Number(FactoryItems[j][l].Asked)});
                        CalcOneBuilding(j,l);
                    }
                }
            }
            AddPowers()
            for (var j = 0; j < lengTiers; j++) {
                var leng = FactoryItems[j].length  
                for (var l = 0; l < leng; l++) {
                    if((FactoryItems[j][l].Recepice[FactoryItems[j][l].RecipeNr].PerBuilding) == 0){
                        continue;
                    }
                    FactoryItems[j][l].Recepice[FactoryItems[j][l].RecipeNr].Buildings = (
                        Math.ceil(FactoryItems[j][l].Needed/FactoryItems[j][l].Recepice[FactoryItems[j][l].RecipeNr].PerBuilding)
                );

                }
            }
        }
</script>
<!-- BUild the Main table-->
<script>


        let debounceTimeouts = {};
        var ShowRecipesExplitily = false;
        var ShowOnlyNeeded = false;
        function togglerecipe(){
            ShowRecipesExplitily = !ShowRecipesExplitily
            console.log("Show REcipe: ", ShowRecipesExplitily)
            BuildAllTables()
        }
        function toggleShowAll(){
            ShowOnlyNeeded = !ShowOnlyNeeded
            console.log("Show REcipe: ", ShowOnlyNeeded)
            BuildAllTables()
        }

        function handleAskedInput(m, InputId,i,key){

            clearTimeout(debounceTimeouts[InputId]);
            debounceTimeouts[InputId] = setTimeout(() => {
                var Input =document.getElementById(InputId);
                console.log("New Asked:", Input.value);
                FactoryItems[m][i][key]=Input.value;
                BuildAllTables();
            }, 400);

        };

        function BuildAllTables(){
            CalcAllBuildings()
            PowerTable()
            RoadTable(0, "table-FactoryBasics")
            RoadTable(1, "table-Factory12")
            RoadTable(2, "table-FactoryMAM")
            RoadTable(3, "table-FactorySteel")
            RoadTable(4, "table-FactoryOil")
            RoadTable(5, "table-FactoryComputing")
            RoadTable(6, "table-FactoryAuminium")
            RoadTable(7, "table-FactoryElectronic")
            RoadTable(8, "table-FactoryEdge")
            RoadTable(9, "table-FactoryNuclear")
            RoadTable(10, "table-FactoryQuantum")
            RoadTable(11, "table-FactoryAssemly")
            CalcFlowChart();

        }

        function RoadTable(m, TableIdentifier) {
            var tableBody = document.getElementById(TableIdentifier);
            var tbody = document.createElement('tbody'); // Create a new tbody element
            tableBody.innerHTML = ''; // Clear the table body
            var keys = Object.keys(FactoryItems[m][0]);
            keys = keys.slice(1);

            // Name
            var key = keys[0];
            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = key;
            Row.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){ continue}
                let Cell = document.createElement('td');
                Cell.textContent = FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr].Name;
                let CycleRecipeButton = document.createElement('button')
                CycleRecipeButton.onclick = (function(m, i) {
                    return function() {
                        FactoryItems[m][i].RecipeNr = (FactoryItems[m][i].RecipeNr + 1) % FactoryItems[m][i].Recepice.length;
                        BuildAllTables() // THis loks recursve, but the function only gets called on cklick!
                    };
                })(m, i);
                CycleRecipeButton.textContent = "Recipe "+(FactoryItems[m][i].RecipeNr+1)+"/"+(FactoryItems[m][i].Recepice.length);
                CycleRecipeButton.style.float = "right";
                Cell.appendChild(CycleRecipeButton);

                Row.appendChild(Cell);
            }
            tbody.appendChild(Row);

            // Asked as Input
            var key = "Asked";
            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = key;
            Row.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){ continue}
                var Item = FactoryItems[m][i];
                var Cell = document.createElement('td');
                var input = document.createElement('input');
                input.id = 'Input' + Item.id + "Asked";
                input.oninput = handleAskedInput.bind(null, m, input.id, i, key);
                input.value = Item.Asked;
                input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                input.style.opacity= 1.5  ; 
                input.style.width= "50px"  ; 

                Cell.appendChild(input);
                Row.appendChild(Cell);
            }
            tbody.appendChild(Row);

            // Ceil for Number
            var key = "Needed";
            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = key;
            Row.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){continue}
                var Cell = document.createElement('td');
                Cell.textContent = Math.ceil(Number( FactoryItems[m][i][key]));
                Row.appendChild(Cell);
            }
            tbody.appendChild(Row);


            // The Builings
            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            {
                var TitleTable = document.createElement('table');

                var Row1 = document.createElement('tr');
                var TitleElem = document.createElement('td');
                TitleElem.textContent = "per Building";
                Row1.appendChild(TitleElem);
                TitleTable.append(Row1);
                var Row2 = document.createElement('tr');
                var TitleElem = document.createElement('td');
                TitleElem.textContent = "Buildings";
                Row2.appendChild(TitleElem);
                TitleTable.append(Row2);
                var Row3 = document.createElement('tr');
                Row3.appendChild(TitleElem);
                TitleTable.append(Row3);
                
                TitleCell.append(TitleTable);
            }
            Row.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){console.log("skip"); continue}
                var TableCell = document.createElement('td');

                var Recepie = FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr];
                
                var Recepicekeys = Object.keys(Recepie);
                var RecepiceTable = document.createElement('table');
                for(var l= 0; l < 2; l++)
                {
                    var RecepiceRow =  document.createElement('tr')
                    var ValueCell = document.createElement('td');

                    ValueCell.textContent =Recepie[Recepicekeys[l]];
                    RecepiceRow.appendChild(ValueCell)
                    RecepiceTable.appendChild(RecepiceRow)
                }
                var RecepiceRow =  document.createElement('tr')

                RecepiceTable.appendChild(RecepiceRow)
                
                TableCell.appendChild(RecepiceTable);
                Row.appendChild(TableCell);
            }
            tbody.appendChild(Row);



            // Needed List as Building Numbers
            var key = keys[3];
            var PerItemRow = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.style.width = "200px"
            TitleCell.textContent = "Need per Item";
            PerItemRow.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){console.log("skip"); continue}
                var Cell = document.createElement('td');
                var NeededList = FactoryItems[m][i].NeededList;
                var NeededTable = document.createElement('table');
                for (var j = 0; j < NeededList.length; j++) {
                    var NeededRow =  document.createElement('tr')
                    var Cell1 = document.createElement('td')
                    Cell1.textContent = NeededList[j].id
                    var Cell2 = document.createElement('td')
                    Cell2.textContent = Math.ceil(NeededList[j].Nr/FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr].PerBuilding)
                    
                    if(FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr].PerBuilding == 0)
                    {
                        Cell2.textContent = "";
                    }
                    var Cell3 = document.createElement('td')
                    Cell3.textContent = Math.ceil(NeededList[j].Nr)
                    NeededRow.appendChild(Cell1)
                    NeededRow.appendChild(Cell2)
                    NeededRow.appendChild(Cell3)
                    if(NeededList[j].Nr != 0 ){
                        NeededTable.appendChild(NeededRow)
                    }
                }
                Cell.appendChild(NeededTable)
                PerItemRow.appendChild(Cell);
            }
            tbody.appendChild(PerItemRow);

            // Explicit recipe
            var RecipeExplRow = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.style.width = "200px"
            TitleCell.textContent = "Recipe used";
            RecipeExplRow.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){console.log("skip"); continue}
                var Cell = document.createElement('td');
                var Recepie = FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr];
                var RecipeExplTable = document.createElement('table');
                for (var j = 0; j < Recepie.Req.length; j++) {
                    var RecipeRow =  document.createElement('tr')
                    var Cell1 = document.createElement('td')
                    Cell1.textContent = Recepie.Req[j].id
                    var Cell2 = document.createElement('td')
                    Cell2.textContent = Math.ceil(Recepie.Req[j].Nr*Recepie.PerBuilding)
                    RecipeRow.appendChild(Cell1)
                    RecipeRow.appendChild(Cell2)
                    RecipeExplTable.appendChild(RecipeRow)
                }
                Cell.appendChild(RecipeExplTable)
                RecipeExplRow.appendChild(Cell);
            }
            if(ShowRecipesExplitily){
                tbody.appendChild(RecipeExplRow);
            }

            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = "Overhead / Underclock to";
            Row.appendChild(TitleCell);
            for (var i = 0; i < FactoryItems[m].length; i++) {
                if(ShowOnlyNeeded && FactoryItems[m][i].Needed == 0){console.log("skip"); continue}
                var Cell = document.createElement('td');
                var recipe = FactoryItems[m][i].Recepice[FactoryItems[m][i].RecipeNr]
                var Overhead = recipe.Buildings*recipe.PerBuilding - FactoryItems[m][i].Needed;
                var Underclock = 1-(Overhead/recipe.PerBuilding);
                if(Underclock === 1) Underclock = 0
                if(FactoryItems[m][i].Needed < 0)
                {
                        Cell.style.background = "red";
                }
                Cell.textContent = (String(Math.floor(Overhead))
                    + " / " + String(Math.ceil(100*Underclock) ) + "%" 
                );
                if(recipe.PerBuilding == 0)
                {
                    Cell.textContent = (String(Overhead))
                }
                Row.appendChild(Cell);
            }
            tbody.appendChild(Row);

            tableBody.appendChild(tbody)
        }
</script>

<!-- Adding new Items/Recipies-->
<script>
        var NewItem = {
                id: "",
                Asked:0, Needed:0,
                NeededList:[],
                RecipeNr:0,
                Recepice:[
                ]
            };
            var NewRecepice = {Name: "", PerBuilding:0,Buildings:0,  Req:[]}

        function NewItemAddRecipe(){
            PerBuildingField = document.getElementById("InputAddingPerBuilding")
            NewRecepice.PerBuilding = PerBuildingField.value
            NewItem.Recepice.push(NewRecepice)
            resetNewRecepice();
        }
        function AddAlternativeRecipe(ItemID)
        {
            var PerBuildingField = document.getElementById("InputAddingPerBuilding")
            NewRecepice.PerBuilding = Number(PerBuildingField.value)
            var index = getIndex(ItemID)

            FactoryItems[index[0]][index[1]].Recepice.push(NewRecepice)
            resetNewRecepice();
            resetNewItem();
            return
        }

        function AddAlternative(){
            var NameField = document.getElementById("InputAddingName")
            var index = getIndex( NameField.value)
            console.log("Copying Item",NameField.value, " from", index)
            if (index === -1) return;
            var ItemCopy = structuredClone(FactoryItems[index[0]][index[1]])
            var RecepiceLength = ItemCopy.Recepice.length
            console.log(ItemCopy.id)
            for(var i = 0; i< RecepiceLength; i++)
            {
                ItemCopy.Recepice[i].Req.push({id: ItemCopy.id, Nr: -1})
            }
            ItemCopy.id = "Alternative" + ItemCopy.id
            console.log(ItemCopy)
            AddToFactory(ItemCopy, index[0])
            BuildAllTables();
        }

        function AddNewItem(){
            NewItemAddRecipe()
            NameField = document.getElementById("InputAddingName")
            NewItem.id  = NameField.value
            
            TierField = document.getElementById("InputAddingTier");

            AddToFactory(NewItem, TierField.value)
            console.log("Adding item: ", NewItem)
            resetNewItem();
        }
        function handleAddButton(){
            var NameField = document.getElementById("InputAddingName")
            var index = getIndex( NameField.value)
            console.log("NEw item name: ",NameField.value)
            console.log("FOund at ", index)
            if( index === -1){
                AddNewItem()
            }
            else(
                AddAlternativeRecipe(NameField.value)
            )

            BuildAllTables()

        }
        function resetNewItem(){
            NewItem = {
                id: "",Name: "",
                Asked:0, Needed:0,
                NeededList:[],
                RecipeNr:0,
                Recepice:[
                ]
            };
            NewRecepice = {Name: "", PerBuilding:0,Buildings:0,  Req:[]}
            BuildAddTable()
        }
        function resetNewRecepice(){
            NewRecepice = {Name: "", PerBuilding:0,Buildings:0,  Req:[]}
        }
        
        function handleAddReqButton(){
            console.log("adding req")
            var ReqItem ={id: '', Nr: 1};

            ReqNameField = document.getElementById("InputAddingReqItem")
            ReqItem.id  = ReqNameField.value;
            PerBuildingField = document.getElementById("InputAddingReqNumber")
            ReqItem.Nr = Number(PerBuildingField.value)

            NewRecepice.Req.push(ReqItem)

            // Add to table to see
            var Row = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = "";
            Row.appendChild(TitleCell);
            var Cell = document.createElement('td');
            Cell.textContent = ReqItem.id;
            Row.appendChild(Cell);
            var Cell = document.createElement('td');
            Cell.textContent = ReqItem.Nr;
            Row.appendChild(Cell);

            tbody = document.getElementById("tbodyAdd")
            tbody.appendChild(Row)
        }



        function BuildAddTable() {
            var tableBody = document.getElementById('add-Factory');
            var tbody = document.createElement('tbody'); // Create a new tbody element
            tbody.id = "tbodyAdd"
            tableBody.innerHTML = ''; // Clear the table body
            var keys = Object.keys(FactoryItems[0][0]);


            var TierRow = document.createElement('tr');
            var TitleCell = document.createElement('td');
            TitleCell.textContent = "Tier";
            TitleCell.style.width = "200px"
            TierRow.appendChild(TitleCell);
            {
                var Cell = document.createElement('td');
                var input = document.createElement('input');
                input.id = 'InputAddingTier';
                input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                input.style.opacity= 1.5  ; 
                input.value = 10;
                Cell.appendChild(input);
                TierRow.appendChild(Cell);
            }
            tbody.appendChild(TierRow);


            {
                var key = "Name";
                var NameRow = document.createElement('tr');
                var TitleCell = document.createElement('td');
                TitleCell.textContent = key;
                NameRow.appendChild(TitleCell);
                var Cell = document.createElement('td');
                var input = document.createElement('input');
                input.id = 'InputAdding' + key;
                input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                input.style.opacity= 1.5  ; 

                Cell.appendChild(input);
                NameRow.appendChild(Cell);
                tbody.appendChild(NameRow);
            }
            {
                NewItem.Recepice.forEach(function(Recipe){
                    RecipRow = document.createElement('tr');
                    var TitleCell = document.createElement('td');
                    TitleCell.textContent = "Recipe";
                    RecipRow.appendChild(TitleCell);
                    var ReqCell = document.createElement('td');
                    

                });
            }
            {
                var key = "PerBuilding";
                var PerRow = document.createElement('tr');
                var TitleCell = document.createElement('td');
                TitleCell.textContent = key;
                PerRow.appendChild(TitleCell);
                var Cell = document.createElement('td');
                var input = document.createElement('input');
                input.id = 'InputAdding' + key;
                input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                input.style.opacity= 1.5  ; 

                Cell.appendChild(input);
                PerRow.appendChild(Cell);
                tbody.appendChild(PerRow);
            }

            {
                var ReqRow = document.createElement('tr');
                var TitleCell = document.createElement('td');
                TitleCell.style.whiteSpace = "pre"
                TitleCell.textContent = "Requirements\nEnter byproducts as negative needs";
                ReqRow.appendChild(TitleCell);

                {
                    var DropDownCell = document.createElement('td');
                    var DropDownSelect = document.createElement("select");
                    DropDownSelect.id = "InputAddingReqItem";

                    // Populate the drop-down with items from FactoryItems
                    FactoryItems.forEach(function(FactoryTier) {
                        FactoryTier.forEach(function(item) {
                            var option = document.createElement("option");
                            option.value = item.id;
                            option.text = item.Recepice[item.RecipeNr].Name;
                            DropDownSelect.appendChild(option);
                        })
                    });
                    DropDownCell.appendChild(DropDownSelect);
                    ReqRow.appendChild(DropDownCell);
                }

                {
                    var NumberCell = document.createElement('td');
                    var input = document.createElement('input');
                    input.id = 'InputAddingReqNumber';
                    input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                    input.style.opacity= 1.5  ; 

                    NumberCell.appendChild(input);
                    ReqRow.appendChild(NumberCell);
                }
                {
                var AddCell = document.createElement('td');
                var AddReqButton = document.createElement('button');
                AddReqButton.id = "AddReqButton"
                AddReqButton.textContent = "Add";
                AddReqButton.onclick=handleAddReqButton;
                AddCell.appendChild(AddReqButton);
                ReqRow.appendChild(AddCell);
                }
            
                tbody.appendChild(ReqRow);
            }

            tableBody.appendChild(tbody)
        }



</script>

<!--Saving -->
<script>

        function saveState() {
            console.log("Saveing");
            CalcAllBuildings();
            var Tiers = FactoryItems.length;
            for(var i = 0; i< Tiers; i++)
            {
                localStorage.setItem('FactoryItemsTier_'+String(i) , JSON.stringify(FactoryItems[i]));   
            }
            console.log("Saved");
            }

    
        function loadFactory() {
            var Tiers = FactoryItems.length;
            for(var i = 0; i< Tiers; i++)
            {
                var storedFactoryItemsTier     = localStorage.getItem('FactoryItemsTier_'+String(i));
                if (storedFactoryItemsTier) {
                    FactoryItems[i] = JSON.parse(storedFactoryItemsTier);
                }
            }
            console.log("Loaded state from memory")
        }
</script>

<!-- Determin the building-->
<script>
     // var Buildings = [Constructor, Assembler, Manufactorer, Refinery, Blender, smelter, Foundary, Miner, Water, Oil, NOne ]
    function BuildingType(Item){
        var fluids = ["Water", "Oil", "Fuel", "HeavyOilResidue"];
        var Ores = ["IronOre", "Iron Ore", "CopperOre", "CopperOre", "Caterium Ore", "Coal", "Quartz", "Limestone", "Bauxit", "Sulfur", "UraniumOre", "SAM"];
        if(Item.Recepice[Item.RecipeNr].Req.some(req => fluids.includes(req.id)))
        {
            if(Item.Recepice[Item.RecipeNr].Req.length <3){
                return 3
            }
            else{
                return 4
            }
        }
        else{
            if(Item.Recepice[Item.RecipeNr].Req.length === 1){
                if(Item.Recepice[Item.RecipeNr].Req.some(req => Ores.includes(req.id))){
                    return 5
                }
                else{ return 0}
            }
            if(Item.Recepice[Item.RecipeNr].Req.length === 2){
                if(Item.Recepice[Item.RecipeNr].Req.some(req => Ores.includes(req.id))){
                    return 6
                }
                else{ return 1}
            }
            if(Item.Recepice[Item.RecipeNr].Req.length > 2){
                return 2
            }
        }
        if(Ores.includes(Item.id)){ return 7;}
        if(Item.id === "Water"){return 8;}
        if(Item.id === "Oil"){return 9;}
        if(Item.id === "HeavyOilResidue"){return 10;}
        if(Item.id === "Uranium Waste"){return 10;}
        if(Item.id === "Power by Hand"){return 10;}
        console.log("No buildig matched to ", Item.id)
        return 10;
    }
    
</script>

<!-- Power-->
<script>
    var PowerSources = [
    {id: "Biomass Burner", Buildings: 0, PerBuilding: 35, Req: []},
    {id: "Coal Power Plant", Buildings: 0, PerBuilding: 75, Req: [{id: "Water", Nr: 45}, {id: "Coal", Nr: 15}]},
    // {id: "Compacted Coal Power Plant", Buildings: 0, PerBuilding: 75, Req: [{id: "Water", Nr: 45}, {id: "Coal", Nr: 15}]},
    {id: "Fuel Power Plant", Buildings: 0, PerBuilding: 125, Req: [{id: "Fuel", Nr: 15}]},
    // {id: "Turbofuel Power Plant", Buildings: 0, PerBuilding: 125, Req: [{id: "Fuel", Nr: 15}]},
    {id: "Uranium Power Plant", Buildings: 0, PerBuilding: 2500, Req: [{id: "Uranium Fuel Rod", Nr: 0.2},{id: "Water", Nr: 240}, {id:"Uranium Waste", Nr: -10}]},
    {id: "Plutonium Power Plant", Buildings: 0, PerBuilding: 2500, Req: [{id: "Plutonium Fuel Rod", Nr: 0.1},{id: "Water", Nr: 240}, {id:"Plutonium Waste", Nr: -1}]},
    {id: "Ficsonium Power Plant", Buildings: 0, PerBuilding: 2500, Req: [{id: "Ficsonium Fuel Rod", Nr: 1},{id: "Water", Nr: 240},]},
    ]
    // var Buildings = [Constructor, Assembler, Manufactorer, Refinery, Blender, smelter, Foundary, Miner, Water, Oil, None ]
    var BuildingsPower = [4, 15, 55, 30,75, 4, 16, 12, 20, 40, 0]
    function PowerConsumption(){
        var Demand = 0;
        FactoryItems.forEach(Tier => {
            Tier.forEach(Item=>{

                Demand += (
                    Item.Recepice[Item.RecipeNr].Buildings
                    *BuildingsPower[ BuildingType(Item)]
                )
            })
        })

        return Demand
    }

    function PowerProduction(){
        var production = 0;
        PowerSources.forEach(source => {
            production += source.Buildings*source.PerBuilding;
        })
        production += FactoryItems[FactoryItems.length-1][0].Needed
        return production
    }

    function handlePowerBuildingInput(NAME){
        var inputfield = document.getElementById('InputPower'+NAME)
        var foundIndex = PowerSources.findIndex(
            item => item.id === NAME);
        if(foundIndex === -1){
            console.log('Cant find', ID)
            return -1
        }
        PowerSources[foundIndex].Buildings = inputfield.value;
        PowerTable()    
        BuildAllTables()
    }
    function updatePowerBar() {
        const production = Math.max(PowerProduction(), 1);
        const consumption = Math.max(1, PowerConsumption());
        const ratio = production / consumption;
        const bar = document.getElementById('power-bar');
        
        let color;
        if (ratio < 1) {
            color = 'red';
        } else if (ratio >= 1 && ratio <= 1.05) {
            color = 'yellow';
        } else {
            color = 'green';
        }
        
        const width = Math.max(5, Math.min(ratio / 1.2 * 100, 100)); // Ensure the width does not exceed 100%

        console.log(`Ratio: ${ratio}, Width: ${width}%, Color: ${color}`); // Debug log

        bar.style.width = width + '%';
        bar.style.backgroundColor = color;
        bar.textContent = String(Math.floor(ratio*100))+"%"
    }

    function PowerTable()
    {
        var tableBody = document.getElementById('table-Power');
        var tbody = document.createElement('tbody'); // Create a new tbody element
        tbody.id = "tbodyAdd"
        tableBody.innerHTML = ''; // Clear the table body
        //Titles
        {
            var TitleRow = document.createElement('tr')
            {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = "Power"
                TitleRow.appendChild(TitleCell)
            }
            {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = "Demand"
                TitleRow.appendChild(TitleCell)
            }
            PowerSources.forEach(element => {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = element.id
                TitleRow.appendChild(TitleCell)
            });
            tbody.appendChild(TitleRow)
        }
        
        // Power Production
        {
            var ProdRow = document.createElement('tr')
            {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = "Production"
                ProdRow.appendChild(TitleCell)
            }
            {
                var TitleCell2 = document.createElement('td')
                TitleCell2.textContent = String(PowerProduction()) + "/" + String(PowerConsumption())
                ProdRow.appendChild(TitleCell2)
            }
            PowerSources.forEach(element => {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = element.Buildings*element.PerBuilding
                ProdRow.appendChild(TitleCell)
            });
            tbody.appendChild(ProdRow)
        }
        {
            var BuildingsRow = document.createElement('tr')
            {
                var TitleCell = document.createElement('td')
                TitleCell.textContent = "Buildings"
                BuildingsRow.appendChild(TitleCell)
            }
            {
                var TitleCell2 = document.createElement('td')
                 // Create bar container and bar
                var barContainer = document.createElement('div');
                barContainer.className = 'bar-container';
                var bar = document.createElement('div');
                bar.className = 'bar';
                bar.id = 'power-bar';
                barContainer.appendChild(bar);
                /*
                var marker1 = document.createElement('div');
                marker1.className = 'marker';
                marker1.style.color = 'black'
                marker1.style.left = (1 / 1.2 * 100) + '%'; // Position of 1 on the bar
                barContainer.appendChild(marker1);
                */

                // barContainer.textContent = (PowerProduction()/PowerConsumption())
                barContainer.style.backgroundColor = "transparent";
                // Append bar container to the table cell
                TitleCell2.appendChild(barContainer);
                BuildingsRow.appendChild(TitleCell2)
            }
            PowerSources.forEach(element => {
                var Cell = document.createElement('td');
                var input = document.createElement('input');
                input.id = 'InputPower'+element.id;
                input.oninput = handlePowerBuildingInput.bind(null, element.id);
                input.value = element.Buildings;
                input.style.backgroundColor= 'transparent'; /* Set the background color to transparent */
                input.style.opacity= 1.5  ; 
                input.style.width= "50px"  ; 

                Cell.appendChild(input);
                BuildingsRow.appendChild(Cell);
            });
            tbody.appendChild(BuildingsRow)
        }
        tableBody.appendChild(tbody)
        updatePowerBar()


    }

</script>


<!-- Flow Chart-->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    // Flatten the data into nodes and links

    function CalcFlowChart() {
        var flatendItems = FactoryItems.flat();
        // Clear previous SVG
        d3.select("#flowchart").select("svg").remove();

        // Create nodes from the data
        const nodes = flatendItems
            .filter(item => item.Needed !== 0)
            .map(item => ({
                id: item.id,
                name: String(item.Recepice[item.RecipeNr].Buildings) + "x " + item.Recepice[item.RecipeNr].Name,
                info: item
            }));

        // Add power sources as nodes
        PowerSources.forEach(Power => {
            if (Power.Buildings != 0) {
                nodes.push({ id: Power.id,Name: Power.id, info: Power });
            }
        });

        // Function to rescale link width based on amount
        function RescaledWidth(amount) {
            return 2 * (4 - 2*Math.exp(-Math.abs(amount) / 50)- Math.exp(-Math.abs(amount) / 500));
        }

        // Create links from the data
        const links = [];
        flatendItems.forEach(item => {
            if (item.id === "Power by Hand") return;

            item.NeededList.forEach(Goal => {
                if (Goal.id === "out" || Goal.Nr === 0) return;
                if (Goal.id === "Power by Hand") return;
                if (item.Needed === 0) {
                    nodes.push({
                        id: item.id,
                        name: String(item.Recepice[item.RecipeNr].Buildings) + "x " +  item.Recepice[item.RecipeNr].Name,
                        info: item
                    });
                }
                if (Goal.Nr > 0) {
                    links.push({
                        source: item.id,
                        target: Goal.id,
                        amount: Goal.Nr,
                        color: item.color
                    });
                }
                if (Goal.Nr < 0) {
                    links.push({
                        source: Goal.id,
                        target: item.id,
                        amount: -Goal.Nr,
                        color: item.color
                    });
                }
            });
        });

        console.log({ nodes, links });

        // Define the dimensions of the SVG
        const width = window.innerWidth;
        const height = 1500;

        // Create the SVG element
        const svg = d3.select("#flowchart")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("border", "2px solid black");

        // Create unique markers for each link color dynamically
        links.forEach((link, index) => {
            svg.append("defs").append("marker")
                .attr("id", `end-arrow-${index}`)
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 10)
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("stroke", link.color)  // Set the stroke color to match the link's color
                .attr("fill", link.color);   // Set the fill color to match the link's color
        });

        // Initialize the force simulation
        let chargeStrength = -500;
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(50))
            .force("charge", d3.forceManyBody().strength(chargeStrength))
            .force("center", d3.forceCenter(width / 2, height / 2));

        // Create the links (lines) between nodes
        const link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links)
            .enter()
            .append("line")
            .attr("class", "link")
            .attr("marker-end", (d, i) => `url(#end-arrow-${i})`) // Use the dynamically created marker
            .style("stroke-width", d => RescaledWidth(d.amount))
            .style("stroke", d => d.color); // Set the line color to the link's color

        // Add labels to the links
        const linkText = svg.append("g")
            .attr("class", "link-labels")
            .selectAll("text")
            .data(links)
            .enter()
            .append("text")
            .attr("class", "link-text")
            .attr("dy", -3)
            .attr("text-anchor", "middle")
            .style("font-size", "12px")
            .style("fill", "#333")
            .text(d => Math.ceil(d.amount));

        // Create the nodes and add drag functionality
        const node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("g")
            .data(nodes)
            .enter().append("g");

        node.append("circle")
            .attr("r", 10)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("text")
            .attr("x", 15)
            .attr("dy", ".35em")
            .text(d => d.name);

        // Simulation tick actions
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            linkText
                .attr("x", d => (d.source.x + d.target.x) / 2)
                .attr("y", d => (d.source.y + d.target.y) / 2);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Drag event functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
        // Event listener for the slider to adjust the charge strength
        d3.select("#strength-slider").on("input", function() {
            chargeStrength = +this.value; // Get the slider value as a number
            simulation.force("charge", d3.forceManyBody().strength(chargeStrength)); // Update the force strength
            simulation.alpha(1).restart(); // Restart the simulation with new settings
        });
    }
</script>

</head>

<body>

    <h1> Factory planer</h1>
        <h2> Items</h2>
        <h3> Tier 0: Basics</h3>
        <div>
        <table id="table-FactoryBasics">
        </table>
        </div>
        <h3> Tiers 1 and 2: Part Assembly</h3>
        <div>
        <table id="table-Factory12">
        </table>
        </div>
        <h3> MAM Research</h3>
        <div>
        <table id="table-FactoryMAM">
        </table>
        </div>
        <h3> Tiers 3 and 4: Steel Production</h3>
        <div>
        <table id="table-FactorySteel">
        </table>
        </div>
        <h3> Tiers 5: Oil</h3>
        <div>
        <table id="table-FactoryOil">
        </table>
        </div>

        <h3> Tiers 6: Industrial Manufacturing</h3>
        <div>
        <table id="table-FactoryComputing">
        </table>
        </div>
        <h3> Tiers 7: Aluminium</h3>
        <div>
        <table id="table-FactoryAuminium">
        </table>
        <h3> Tiers 7: Advanced electric</h3>
        <div>
        <table id="table-FactoryElectronic">
        </table>
        </div>
        <h3> Tiers 8: Advanced and Leading-Edge</h3>
        <div>
        <table id="table-FactoryEdge">
        </table>
        </div>
        <h3> Tiers 7&8: Nuclear</h3>
        <div>
        <table id="table-FactoryNuclear">
        </table>
        </div>
        <h3> Tiers 9: Quantum Technology</h3>
        <div>
        <table id="table-FactoryQuantum">
        </table>
        </div>
        <h3> Tiers 9: Project Assembly</h3>
        <div>
        <table id="table-FactoryAssemly">
        </table>
        </div>
        <button onclick=BuildAllTables()>Recalulate</button>
        <button onclick=saveState()>Saving</button>
        <button onclick=loadFactory()>Reload</button>
        <button onclick=togglerecipe()>Toggle Recipe</button>
        <button onclick=toggleShowAll()>Toggle All Items</button>

        <h2> Add New Recipe:</h2>
        If the name is already taken, the recipe gets added as an alternate
        <br>
        IF you want to use two recipies for the same item,
        the curent best practice is to add the alternative item as an extra Recipe
        with the item as a byprodukt and as well as main product,
        then manually set the prevered production rate as Asked.
        
        <br>
        You can also use this to create "factory modules".
        Seperatly calulate the in and output of the
        moduls, e.g. in a seperate tab, and include them as a new "Item".
        You maually have to set the number via the "asked" fields later.
        <br>
        Carefull with loops! When the main Product is part of a loop, the website can crash.
        This can be avoided by adding the recipe as an alternate, although the value has to be adjusted by hand
        <div id="Add-container">
        <table id="add-Factory">
        </table>
        </div>
        <button id= "AddToFactoryButton" onclick=handleAddButton()>Add</button>
        <button id= "ResetNEwItem" onclick=resetNewItem()>Reset Requirements</button>
        <button id= "AddAlternative" onclick=AddAlternative()>Copy Item</button>


        <h2> Power </h2>
        <div id="table-containerpower">
            <table id="table-Power">
            </table>
        </div>

        <div>
            <label for="strength-slider">Adjust Flowchart Strength: </label>
            <input type="range" id="strength-slider" min="-2000" max="500" value="-500" step="20">
        </div>
        <div id="flowchart"></div>

</body>
